<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>循环问候语</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.8/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    
    <!-- Tailwind 配置 -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#165DFF',
                        secondary: '#36CFC9',
                        accent: '#722ED1',
                        dark: '#1D2129',
                        light: '#F2F3F5'
                    },
                    fontFamily: {
                        inter: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    
    <!-- 自定义工具类 -->
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            }
            .transition-custom {
                transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            }
        }
    </style>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
        }
        
        .greeting-card {
            animation: fadeIn 0.8s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .gradient-bg {
            background: linear-gradient(135deg, #165DFF 0%, #722ED1 100%);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 导航栏 -->
    <nav class="fixed top-0 w-full bg-white shadow-md z-50 transition-all duration-300" id="navbar">
        <div class="container mx-auto px-4 py-3 flex justify-between items-center">
            <div class="flex items-center space-x-2">
                <i class="fa-solid fa-comments text-primary text-2xl"></i>
                <h1 class="text-xl font-bold text-dark">循环问候语</h1>
            </div>
            <div class="hidden md:flex items-center space-x-6">
                <a href="#greetings" class="text-gray-600 hover:text-primary transition-colors">问候语</a>
                <a href="#add-greeting" class="text-gray-600 hover:text-primary transition-colors">添加问候</a>
                <a href="#stats" class="text-gray-600 hover:text-primary transition-colors">统计</a>
            </div>
            <button class="md:hidden text-gray-600 focus:outline-none" id="menu-toggle">
                <i class="fa-solid fa-bars text-xl"></i>
            </button>
        </div>
        <!-- 移动端菜单 -->
        <div class="md:hidden hidden bg-white shadow-lg absolute w-full" id="mobile-menu">
            <div class="container mx-auto px-4 py-2 flex flex-col space-y-3">
                <a href="#greetings" class="text-gray-600 hover:text-primary py-2 transition-colors">问候语</a>
                <a href="#add-greeting" class="text-gray-600 hover:text-primary py-2 transition-colors">添加问候</a>
                <a href="#stats" class="text-gray-600 hover:text-primary py-2 transition-colors">统计</a>
            </div>
        </div>
    </nav>

    <!-- 主内容 -->
    <main class="container mx-auto px-4 pt-24 pb-16">
        <!-- 问候语展示区域 -->
        <section id="greetings" class="mb-16">
            <div class="text-center mb-8">
                <h2 class="text-[clamp(1.8rem,4vw,2.5rem)] font-bold text-dark mb-2">
                    <i class="fa-solid fa-heart text-primary animate-pulse"></i> 今日问候
                </h2>
                <p class="text-gray-600 max-w-2xl mx-auto">
                    每天一句问候语，传递温暖与正能量。问候语将每5秒自动切换，为你带来不同的心情体验。
                </p>
            </div>
            
            <div class="max-w-3xl mx-auto bg-white rounded-2xl shadow-xl p-8 md:p-10 mb-8 relative overflow-hidden">
                <!-- 装饰元素 -->
                <div class="absolute -top-10 -right-10 w-32 h-32 bg-primary/10 rounded-full"></div>
                <div class="absolute -bottom-10 -left-10 w-24 h-24 bg-secondary/10 rounded-full"></div>
                
                <div class="relative z-10">
                    <!-- 当前问候语 -->
                    <div id="current-greeting" class="greeting-card text-center">
                        <i class="fa-solid fa-quote-left text-4xl text-primary/20 mb-4 block"></i>
                        <p class="text-[clamp(1.2rem,3vw,1.8rem)] font-medium text-gray-800 mb-6 leading-relaxed">
                            加载中...
                        </p>
                        <div class="flex justify-center items-center">
                            <span id="greeting-author" class="text-gray-500 italic">— 系统</span>
                        </div>
                    </div>
                    
                    <!-- 进度指示器 -->
                    <div class="mt-8 flex justify-center">
                        <div id="progress-indicator" class="h-1 w-full max-w-lg bg-gray-200 rounded-full overflow-hidden">
                            <div id="progress-bar" class="h-full w-0 bg-primary transition-all duration-5000"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 控制按钮 -->
            <div class="flex justify-center space-x-4">
                <button id="prev-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-5 py-2 rounded-full transition-all flex items-center space-x-2">
                    <i class="fa-solid fa-chevron-left"></i>
                    <span>上一条</span>
                </button>
                <button id="play-pause-btn" class="bg-primary hover:bg-primary/90 text-white px-6 py-2 rounded-full transition-all flex items-center space-x-2">
                    <i class="fa-solid fa-pause" id="play-pause-icon"></i>
                    <span id="play-pause-text">暂停</span>
                </button>
                <button id="next-btn" class="bg-gray-200 hover:bg-gray-300 text-gray-700 px-5 py-2 rounded-full transition-all flex items-center space-x-2">
                    <span>下一条</span>
                    <i class="fa-solid fa-chevron-right"></i>
                </button>
            </div>
        </section>
        
        <!-- 添加问候语表单 -->
        <section id="add-greeting" class="mb-16">
            <div class="max-w-2xl mx-auto bg-white rounded-2xl shadow-lg p-8">
                <h2 class="text-2xl font-bold text-dark mb-6 flex items-center">
                    <i class="fa-solid fa-plus-circle text-primary mr-2"></i> 添加新问候语
                </h2>
                
                <form id="greeting-form" class="space-y-5">
                    <div>
                        <label for="greeting-text" class="block text-sm font-medium text-gray-700 mb-1">问候语内容</label>
                        <textarea id="greeting-text" rows="4" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="输入一句温暖的问候语..."></textarea>
                    </div>
                    
                    <div>
                        <label for="greeting-author" class="block text-sm font-medium text-gray-700 mb-1">作者 (选填)</label>
                        <input type="text" id="greeting-author" class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary/50 focus:border-primary transition-all" placeholder="问候语的作者或来源">
                    </div>
                    
                    <div class="flex items-center">
                        <input type="checkbox" id="is-public" class="w-4 h-4 text-primary border-gray-300 rounded focus:ring-primary">
                        <label for="is-public" class="ml-2 text-sm text-gray-700">设为公开，与他人分享</label>
                    </div>
                    
                    <div>
                        <button type="submit" class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-all flex items-center justify-center space-x-2">
                            <i class="fa-solid fa-paper-plane"></i>
                            <span>提交问候语</span>
                        </button>
                    </div>
                </form>
                
                <!-- 提交成功提示 -->
                <div id="success-message" class="hidden mt-4 p-4 bg-green-50 border border-green-200 rounded-lg">
                    <div class="flex items-start">
                        <div class="flex-shrink-0">
                            <i class="fa-solid fa-check-circle text-green-500"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800">提交成功！</h3>
                            <div class="mt-2 text-sm text-green-700">
                                <p>你的问候语已成功添加到系统中，将在循环中展示。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- 统计信息 -->
        <section id="stats" class="mb-16">
            <div class="text-center mb-8">
                <h2 class="text-2xl font-bold text-dark mb-2">问候语统计</h2>
                <p class="text-gray-600">查看当前问候语库的统计信息</p>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- 卡片1 -->
                <div class="bg-white rounded-xl shadow-lg p-6 transition-all hover:shadow-xl">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-700">总问候语数</h3>
                        <div class="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center">
                            <i class="fa-solid fa-comments text-primary"></i>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="total-greetings">0</p>
                    <p class="text-sm text-gray-500 mt-1">自系统上线以来</p>
                </div>
                
                <!-- 卡片2 -->
                <div class="bg-white rounded-xl shadow-lg p-6 transition-all hover:shadow-xl">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-700">今日更新</h3>
                        <div class="w-10 h-10 rounded-full bg-secondary/10 flex items-center justify-center">
                            <i class="fa-solid fa-calendar-day text-secondary"></i>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="today-updates">0</p>
                    <p class="text-sm text-gray-500 mt-1">今天新增的问候语</p>
                </div>
                
                <!-- 卡片3 -->
                <div class="bg-white rounded-xl shadow-lg p-6 transition-all hover:shadow-xl">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold text-gray-700">最受欢迎</h3>
                        <div class="w-10 h-10 rounded-full bg-accent/10 flex items-center justify-center">
                            <i class="fa-solid fa-star text-accent"></i>
                        </div>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="most-popular">加载中...</p>
                    <p class="text-sm text-gray-500 mt-1">被展示次数最多</p>
                </div>
            </div>
            
            <!-- 图表 -->
            <div class="mt-8 bg-white rounded-xl shadow-lg p-6">
                <h3 class="text-lg font-semibold text-gray-700 mb-4">问候语类型分布</h3>
                <div class="h-64">
                    <canvas id="greeting-chart"></canvas>
                </div>
            </div>
        </section>
    </main>

    <!-- 页脚 -->
    <footer class="bg-dark text-white py-10">
        <div class="container mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <div class="flex items-center space-x-2 mb-4">
                        <i class="fa-solid fa-comments text-primary text-2xl"></i>
                        <h3 class="text-xl font-bold">循环问候语</h3>
                    </div>
                    <p class="text-gray-400 mb-4">
                        每天一句问候语，传递温暖与正能量。让简单的话语带给你美好的心情。
                    </p>
                    <div class="flex space-x-4">
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa-brands fa-github text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa-brands fa-twitter text-xl"></i>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-white transition-colors">
                            <i class="fa-brands fa-instagram text-xl"></i>
                        </a>
                    </div>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">快速链接</h4>
                    <ul class="space-y-2">
                        <li><a href="#greetings" class="text-gray-600 hover:text-primary transition-colors">问候语</a></li>
                        <li><a href="#add-greeting" class="text-gray-600 hover:text-primary transition-colors">添加问候</a></li>
                        <li><a href="#stats" class="text-gray-600 hover:text-primary transition-colors">统计</a></li>
                        <li><a href="#" class="text-gray-600 hover:text-white transition-colors">关于我们</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 class="text-lg font-semibold mb-4">联系我们</h4>
                    <ul class="space-y-2">
                        <li class="flex items-center space-x-2">
                            <i class="fa-solid fa-envelope text-primary"></i>
                            <a href="mailto:hello@example.com" class="text-gray-400 hover:text-white transition-colors">hello@example.com</a>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fa-solid fa-phone text-primary"></i>
                            <span class="text-gray-400">+1 (555) 123-4567</span>
                        </li>
                        <li class="flex items-center space-x-2">
                            <i class="fa-solid fa-map-marker-alt text-primary"></i>
                            <span class="text-gray-400">123 问候大道, 阳光城</span>
                        </li>
                    </ul>
                </div>
            </div>
            
            <div class="border-t border-gray-800 mt-8 pt-8 text-center text-gray-500 text-sm">
                <p>&copy; 2025 循环问候语. 保留所有权利.</p>
            </div>
        </div>
    </footer>

    <!-- 模态框 -->
    <div id="loading-modal" class="fixed inset-0 bg-black/50 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-lg p-6 max-w-md w-full">
            <div class="text-center">
                <div class="inline-block animate-spin rounded-full h-8 w-8 border-4 border-primary border-t-transparent mb-4"></div>
                <h3 class="text-lg font-medium text-gray-900 mb-2">加载中</h3>
                <p class="text-gray-500" id="loading-message">正在获取问候语...</p>
            </div>
        </div>
    </div>

    <script>
        // Supabase 配置
        const supabaseUrl = 'https://mfxgytyytipqbctkwwzr.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1meGd5dHl5dGlwcWJjdGt3d3pyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDcxOTU3NzksImV4cCI6MjA2Mjc3MTc3OX0.aZD1kbKjoa8uCvsO9St0qH1hGMIDN8mDtXrhDD2fspU';
        const supabase = createClient(supabaseUrl, supabaseKey);
        
        // 全局变量
        let greetings = [];
        let currentIndex = 0;
        let intervalId = null;
        let isPlaying = true;
        
        // DOM 元素
        const currentGreetingEl = document.getElementById('current-greeting');
        const greetingAuthorEl = document.getElementById('greeting-author');
        const progressBarEl = document.getElementById('progress-bar');
        const playPauseBtn = document.getElementById('play-pause-btn');
        const playPauseIcon = document.getElementById('play-pause-icon');
        const playPauseText = document.getElementById('play-pause-text');
        const prevBtn = document.getElementById('prev-btn');
        const nextBtn = document.getElementById('next-btn');
        const greetingForm = document.getElementById('greeting-form');
        const successMessage = document.getElementById('success-message');
        const loadingModal = document.getElementById('loading-modal');
        const loadingMessage = document.getElementById('loading-message');
        const menuToggle = document.getElementById('menu-toggle');
        const mobileMenu = document.getElementById('mobile-menu');
        const navbar = document.getElementById('navbar');
        const totalGreetingsEl = document.getElementById('total-greetings');
        const todayUpdatesEl = document.getElementById('today-updates');
        const mostPopularEl = document.getElementById('most-popular');
        
        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', async () => {
            showLoading('正在获取问候语...');
            await fetchGreetings();
            hideLoading();
            
            // 如果有问候语，显示第一条
            if (greetings.length > 0) {
                displayGreeting(currentIndex);
                startAutoPlay();
                fetchStats();
                initChart();
            } else {
                currentGreetingEl.innerHTML = '<p class="text-gray-500">暂无问候语，请添加新的问候语。</p>';
            }
            
            // 事件监听
            playPauseBtn.addEventListener('click', togglePlayPause);
            prevBtn.addEventListener('click', showPreviousGreeting);
            nextBtn.addEventListener('click', showNextGreeting);
            greetingForm.addEventListener('submit', handleSubmitGreeting);
            menuToggle.addEventListener('click', toggleMobileMenu);
            
            // 滚动监听
            window.addEventListener('scroll', () => {
                if (window.scrollY > 10) {
                    navbar.classList.add('py-2');
                    navbar.classList.remove('py-3');
                } else {
                    navbar.classList.add('py-3');
                    navbar.classList.remove('py-2');
                }
            });
        });
        
        // 获取问候语
        async function fetchGreetings() {
            try {
                const { data, error } = await supabase
                    .from('greetings')
                    .select('*')
                    .order('created_at', { ascending: true });
                
                if (error) {
                    console.error('Error fetching greetings:', error);
                    alert('获取问候语失败，请稍后重试');
                    return;
                }
                
                greetings = data;
            } catch (error) {
                console.error('Unexpected error:', error);
                alert('发生了意外错误，请稍后重试');
            }
        }
        
        // 显示问候语
        function displayGreeting(index) {
            if (greetings.length === 0) return;
            
            currentIndex = index % greetings.length;
            if (currentIndex < 0) currentIndex = greetings.length - 1;
            
            const greeting = greetings[currentIndex];
            const content = greeting.content;
            const author = greeting.author || '佚名';
            
            // 更新问候语内容
            currentGreetingEl.innerHTML = `
                <i class="fa-solid fa-quote-left text-4xl text-primary/20 mb-4 block"></i>
                <p class="text-[clamp(1.2rem,3vw,1.8rem)] font-medium text-gray-800 mb-6 leading-relaxed">
                    ${content}
                </p>
                <div class="flex justify-center items-center">
                    <span class="text-gray-500 italic">— ${author}</span>
                </div>
            `;
            
            // 更新进度条
            progressBarEl.style.width = '0%';
            
            // 重置问候语卡片动画
            currentGreetingEl.classList.remove('greeting-card');
            void currentGreetingEl.offsetWidth; // 触发重绘
            currentGreetingEl.classList.add('greeting-card');
            
            // 更新显示计数（每次显示时增加计数）
            updateDisplayCount(greeting.id);
        }
        
        // 更新显示计数
        async function updateDisplayCount(greetingId) {
            try {
                // 获取当前显示计数
                const { data, error } = await supabase
                    .from('greetings')
                    .select('display_count')
                    .eq('id', greetingId)
                    .single();
                
                if (error) {
                    console.error('Error fetching display count:', error);
                    return;
                }
                
                // 增加计数
                const newCount = (data.display_count || 0) + 1;
                
                // 更新计数
                const { error: updateError } = await supabase
                    .from('greetings')
                    .update({ display_count: newCount })
                    .eq('id', greetingId);
                
                if (updateError) {
                    console.error('Error updating display count:', updateError);
                }
            } catch (error) {
                console.error('Unexpected error updating display count:', error);
            }
        }
        
        // 开始自动播放
        function startAutoPlay() {
            if (intervalId) clearInterval(intervalId);
            
            intervalId = setInterval(() => {
                if (isPlaying) {
                    showNextGreeting();
                }
            }, 5000);
        }
        
        // 切换播放/暂停状态
        function togglePlayPause() {
            isPlaying = !isPlaying;
            
            if (isPlaying) {
                playPauseIcon.classList.remove('fa-play');
                playPauseIcon.classList.add('fa-pause');
                playPauseText.textContent = '暂停';
                startAutoPlay();
            } else {
                playPauseIcon.classList.remove('fa-pause');
                playPauseIcon.classList.add('fa-play');
                playPauseText.textContent = '播放';
                clearInterval(intervalId);
            }
        }
        
        // 显示上一条问候语
        function showPreviousGreeting() {
            displayGreeting(currentIndex - 1);
            if (isPlaying) {
                resetProgressBar();
            }
        }
        
        // 显示下一条问候语
        function showNextGreeting() {
            displayGreeting(currentIndex + 1);
            if (isPlaying) {
                resetProgressBar();
            }
        }
        
        // 重置进度条
        function resetProgressBar() {
            progressBarEl.style.width = '0%';
            
            // 动画进度条
            setTimeout(() => {
                progressBarEl.style.width = '100%';
            }, 10);
        }
        
        // 处理提交问候语
        async function handleSubmitGreeting(e) {
            e.preventDefault();
            
            const content = document.getElementById('greeting-text').value.trim();
            const author = document.getElementById('greeting-author').value.trim();
            const isPublic = document.getElementById('is-public').checked;
            
            if (!content) {
                alert('请输入问候语内容');
                return;
            }
            
            showLoading('正在提交问候语...');
            
            try {
                const { error } = await supabase.from('greetings').insert([
                    {
                        content,
                        author: author || null,
                        is_public: isPublic,
                        display_count: 0
                    }
                ]);
                
                if (error) {
                    console.error('Error submitting greeting:', error);
                    alert('提交问候语失败，请稍后重试');
                } else {
                    // 清空表单
                    document.getElementById('greeting-text').value = '';
                    document.getElementById('greeting-author').value = '';
                    document.getElementById('is-public').checked = false;
                    
                    // 显示成功消息
                    successMessage.classList.remove('hidden');
                    
                    // 5秒后隐藏成功消息
                    setTimeout(() => {
                        successMessage.classList.add('hidden');
                    }, 5000);
                    
                    // 重新加载问候语
                    await fetchGreetings();
                    fetchStats();
                    
                    // 如果之前没有问候语，显示新添加的
                    if (greetings.length === 1) {
                        displayGreeting(0);
                        startAutoPlay();
                    }
                }
            } catch (error) {
                console.error('Unexpected error:', error);
                alert('发生了意外错误，请稍后重试');
            } finally {
                hideLoading();
            }
        }
        
        // 切换移动菜单
        function toggleMobileMenu() {
            mobileMenu.classList.toggle('hidden');
        }
        
        // 显示加载模态框
        function showLoading(message) {
            loadingMessage.textContent = message;
            loadingModal.classList.remove('hidden');
        }
        
        // 隐藏加载模态框
        function hideLoading() {
            loadingModal.classList.add('hidden');
        }
        
        // 获取统计信息
        async function fetchStats() {
            try {
                // 获取总问候语数
                const { count, error: countError } = await supabase
                    .from('greetings')
                    .select('id', { count: 'exact', head: true });
                
                if (countError) {
                    console.error('Error fetching count:', countError);
                } else {
                    totalGreetingsEl.textContent = count || 0;
                }
                
                // 获取今日更新数
                const today = new Date().toISOString().split('T')[0];
                const { data: todayData, error: todayError } = await supabase
                    .from('greetings')
                    .select('id')
                    .gte('created_at', `${today}T00:00:00Z`)
                    .lte('created_at', `${today}T23:59:59Z`);
                
                if (todayError) {
                    console.error('Error fetching today updates:', todayError);
                } else {
                    todayUpdatesEl.textContent = todayData?.length || 0;
                }
                
                // 获取最受欢迎的问候语
                const { data: popularData, error: popularError } = await supabase
                    .from('greetings')
                    .select('content')
                    .order('display_count', { ascending: false })
                    .limit(1);
                
                if (popularError) {
                    console.error('Error fetching popular greeting:', popularError);
                } else if (popularData && popularData.length > 0) {
                    // 截取前10个字符
                    const shortContent = popularData[0].content.length > 10 
                        ? popularData[0].content.substring(0, 10) + '...' 
                        : popularData[0].content;
                    mostPopularEl.textContent = shortContent;
                }
            } catch (error) {
                console.error('Unexpected error fetching stats:', error);
            }
        }
        
        // 初始化图表
        function initChart() {
            const ctx = document.getElementById('greeting-chart').getContext('2d');
            
            // 模拟数据
            const data = {
                labels: ['励志', '友情', '爱情', '家庭', '工作', '生活'],
                datasets: [{
                    label: '问候语类型分布',
                    data: [30, 25, 20, 15, 5, 5],
                    backgroundColor: [
                        'rgba(22, 93, 255, 0.7)',
                        'rgba(54, 207, 201, 0.7)',
                        'rgba(114, 46, 209, 0.7)',
                        'rgba(255, 102, 102, 0.7)',
                        'rgba(255, 159, 64, 0.7)',
                        'rgba(75, 192, 192, 0.7)'
                    ],
                    borderColor: [
                        'rgba(22, 93, 255, 1)',
                        'rgba(54, 207, 201, 1)',
                        'rgba(114, 46, 209, 1)',
                        'rgba(255, 102, 102, 1)',
                        'rgba(255, 159, 64, 1)',
                        'rgba(75, 192, 192, 1)'
                    ],
                    borderWidth: 1
                }]
            };
            
            // 配置
            const config = {
                type: 'doughnut',
                data: data,
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'right',
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    const label = context.label || '';
                                    const value = context.raw || 0;
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = Math.round((value / total) * 100);
                                    return `${label}: ${value} (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateScale: true,
                        animateRotate: true
                    }
                }
            };
            
            // 创建图表
            new Chart(ctx, config);
        }
    </script>
</body>
</html>    